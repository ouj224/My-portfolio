<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>PROJECT</title>
  <link href="style.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <header>
    <div class="header-container">
      <div class="logo"><a href="index.html">MY PORTFOLIO</a></div>
      <nav>
        <ul>
          <li><a href="about.html"><img src="images/icon_about.png" alt="about" class="menu-icon"> ABOUT</a></li>
          <li><a href="resume.html"><img src="images/icon_resume.png" alt="resume" class="menu-icon"> RESUME</a></li>
          <li><a href="project.html" class="active"><img src="images/icon_project.png" alt="project" class="menu-icon"> PROJECT</a></li>
          <li><a href="library.html"><img src="images/icon_library.png" alt="library" class="menu-icon"> LIBRARY</a></li>
          <li><a href="contact.html"><img src="images/icon_contact.png" alt="contact" class="menu-icon"> CONTACT</a></li>
          <li><a href="board.html"><img src="images/icon_board.png" alt="board" class="menu-icon"> BOARD</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div class="sub-banner"><h2>PROJECT</h2></div>

  <div class="container">
    <div class="content-header">
      <h3>í”„ë¡œì íŠ¸ ê°¤ëŸ¬ë¦¬</h3>
      <button onclick="openWriteModal()" class="btn-upload"><i class="fas fa-plus"></i> í”„ë¡œì íŠ¸ ë“±ë¡</button>
    </div>

    <table class="board-table">
        <thead>
            <tr>
                <th width="10%">No.</th>
                <th width="60%">í”„ë¡œì íŠ¸ëª…</th>
                <th width="15%">ì‘ì„±ì</th>
                <th width="15%">ë‚ ì§œ</th>
            </tr>
        </thead>
        <tbody id="projectList"></tbody>
    </table>
  </div>

  <div id="writeModal" class="modal-overlay">
      <div class="modal-content">
          <span class="close-modal" onclick="closeWriteModal()">&times;</span>
          <h3 id="modalTitle">ìƒˆ í”„ë¡œì íŠ¸ ë“±ë¡</h3>
          <input type="text" id="postTitle" placeholder="í”„ë¡œì íŠ¸ëª…" class="auth-input">
          <textarea id="postContent" rows="8" placeholder="í”„ë¡œì íŠ¸ ì„¤ëª…..." class="resume-editor" style="margin-top:10px;"></textarea>
          <div style="margin-top:10px;">
             <label style="font-weight:bold;">ëŒ€í‘œ ì´ë¯¸ì§€/íŒŒì¼:</label>
             <input type="file" id="postFile" accept="image/*">
          </div>
          <button onclick="submitPost()" class="btn-upload" style="width:100%; margin-top:20px;">ì €ì¥í•˜ê¸°</button>
      </div>
  </div>

  <div id="detailModal" class="modal-overlay">
    <div class="modal-content">
        <span class="close-modal" onclick="closeDetailModal()">&times;</span>
        <h2 id="detailTitle" style="color:#004098; border-bottom:1px solid #ddd; padding-bottom:10px;"></h2>
        <div style="margin:10px 0; color:#888;">
            ì‘ì„±ì: <span id="detailAuthor"></span> | <span id="detailDate"></span>
        </div>
        
        <div id="detailImageArea" class="detail-image-container" style="display:none;">
            <img id="detailImage" src="" alt="í”„ë¡œì íŠ¸ ì´ë¯¸ì§€" class="detail-image">
        </div>

        <div id="detailContent" class="post-detail-content"></div>
        <div id="ownerActions" style="text-align:right; display:none;">
            <button onclick="openEditModal()" class="btn-upload" style="background-color:#f39c12; margin-right:5px;">ìˆ˜ì •</button>
            <button onclick="deleteCurrentPost()" class="btn-upload" style="background-color:#e74c3c;">ì‚­ì œ</button>
        </div>
    </div>
  </div>

  <footer>
    <div class="footer-content"><p>Copyright Â© 2025 All Rights Reserved.</p></div>
  </footer>

  <script src="script.js"></script>
  <script>
    const API_ENDPOINT = '/api/projects'; 
    let currentUserId = null; let currentPostId = null; let allPosts = []; let isEditing = false;

    document.addEventListener("DOMContentLoaded", () => {
        fetch('/api/me').then(res => res.json()).then(data => { currentUserId = data.userId; loadPosts(); });
    });

    function loadPosts() {
        fetch(API_ENDPOINT).then(res => res.json()).then(posts => {
            allPosts = posts;
            const tbody = document.getElementById('projectList');
            if(posts.length === 0) { tbody.innerHTML = '<tr><td colspan="4" style="padding:20px;">ë“±ë¡ëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>'; return; }
            tbody.innerHTML = posts.map((post, idx) => `
                <tr>
                    <td>${idx + 1}</td>
                    <td style="text-align:left; padding-left:20px;">
                        <span class="board-title-link" onclick="openDetailModal('${post._id}')">${post.title} ${post.fileName ? 'ğŸ–¼ï¸' : ''}</span>
                    </td>
                    <td>${post.authorName}</td>
                    <td>${new Date(post.createdAt).toLocaleDateString()}</td>
                </tr>
            `).join('');
        });
    }

    function openDetailModal(postId) {
        const post = allPosts.find(p => p._id === postId);
        if(!post) return;
        currentPostId = post._id;
        document.getElementById('detailTitle').innerText = post.title;
        document.getElementById('detailAuthor').innerText = post.authorName;
        document.getElementById('detailDate').innerText = new Date(post.createdAt).toLocaleString();
        document.getElementById('detailContent').innerText = post.content;
        
        const imgArea = document.getElementById('detailImageArea');
        if (post.fileName) {
            document.getElementById('detailImage').src = `/uploads/${post.fileName}`;
            imgArea.style.display = 'block';
        } else {
            imgArea.style.display = 'none';
        }
        
        document.getElementById('ownerActions').style.display = (currentUserId && parseInt(post.userId) === parseInt(currentUserId)) ? 'block' : 'none';
        document.getElementById('detailModal').classList.add('open');
    }

    function openEditModal() {
        const post = allPosts.find(p => p._id === currentPostId);
        if (!post) return;
        isEditing = true;
        document.getElementById('modalTitle').innerText = "í”„ë¡œì íŠ¸ ìˆ˜ì •";
        document.getElementById('postTitle').value = post.title;
        document.getElementById('postContent').value = post.content;
        closeDetailModal();
        document.getElementById('writeModal').classList.add('open');
    }

    function openWriteModal() {
        isEditing = false;
        document.getElementById('modalTitle').innerText = "ìƒˆ í”„ë¡œì íŠ¸ ë“±ë¡";
        document.getElementById('postTitle').value = "";
        document.getElementById('postContent').value = "";
        document.getElementById('postFile').value = "";
        document.getElementById('writeModal').classList.add('open');
    }

    function submitPost() {
        const title = document.getElementById('postTitle').value;
        const content = document.getElementById('postContent').value;
        const fileInput = document.getElementById('postFile');

        if(!title) { alert('ì œëª© ì…ë ¥!'); return; }

        const formData = new FormData();
        formData.append('title', title);
        formData.append('content', content);
        if (fileInput.files[0]) formData.append('file', fileInput.files[0]);

        const url = isEditing ? `${API_ENDPOINT}/${currentPostId}` : API_ENDPOINT;
        const method = isEditing ? 'PUT' : 'POST';

        fetch(url, { method: method, body: formData }).then(() => { closeWriteModal(); loadPosts(); });
    }

    function deleteCurrentPost() { if(confirm('ì‚­ì œ?')) fetch(`${API_ENDPOINT}/${currentPostId}`, { method: 'DELETE' }).then(() => { closeDetailModal(); loadPosts(); }); }
    function closeWriteModal() { document.getElementById('writeModal').classList.remove('open'); }
    function closeDetailModal() { document.getElementById('detailModal').classList.remove('open'); }
  </script>
</body>
</html>